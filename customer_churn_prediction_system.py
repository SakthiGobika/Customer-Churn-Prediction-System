# -*- coding: utf-8 -*-
"""Customer Churn Prediction System.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1UBvzOBt0ow8DgMyxtSW0sha-pvmUvtlx
"""

import pandas as pd

df = pd.read_excel("/content/Telco_customer_churn.xlsx")
df.head()

df.shape
df.info()
df.isnull().sum()
df['Churn Value'].value_counts(normalize=True)

drop_cols = [
    'CustomerID',
    'Count',
    'Country',
    'State',
    'City',
    'Zip Code',
    'Lat Long',
    'Latitude',
    'Longitude',
    'Churn Label',
    'Churn Score',
    'Churn Reason'
]

df_model = df.drop(columns=drop_cols)

df_model['Total Charges'] = pd.to_numeric(
    df_model['Total Charges'],
    errors='coerce'
)

df_model['Total Charges'].isnull().sum()

df_model['Total Charges'].fillna(
    df_model['Total Charges'].median(),
    inplace=True
)

X = df_model.drop('Churn Value', axis=1)
y = df_model['Churn Value']

categorical_cols = X.select_dtypes(include='object').columns
numerical_cols = X.select_dtypes(exclude='object').columns

print("Categorical columns:", len(categorical_cols))
print("Numerical columns:", len(numerical_cols))

y.value_counts(normalize=True)

import seaborn as sns
import matplotlib.pyplot as plt

sns.countplot(x=df_model['Contract'], hue=y)
plt.show()

sns.boxplot(x=y, y=df_model['Tenure Months'])
plt.show()

X_encoded = pd.get_dummies(
    X,
    columns=categorical_cols,
    drop_first=True
)

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(
    X_encoded,
    y,
    test_size=0.2,
    random_state=42,
    stratify=y
)

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()

X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

from sklearn.linear_model import LogisticRegression

lr = LogisticRegression(max_iter=1000)
lr.fit(X_train_scaled, y_train)

from sklearn.metrics import classification_report, roc_auc_score

y_pred = lr.predict(X_test_scaled)
y_prob = lr.predict_proba(X_test_scaled)[:,1]

print(classification_report(y_test, y_pred))
print("ROC-AUC:", roc_auc_score(y_test, y_prob))

from sklearn.ensemble import RandomForestClassifier

rf = RandomForestClassifier(
    n_estimators=300,
    random_state=42,
    class_weight='balanced'
)

rf.fit(X_train, y_train)

from sklearn.metrics import classification_report, roc_auc_score

y_pred_rf = rf.predict(X_test)
y_prob_rf = rf.predict_proba(X_test)[:, 1]

print(classification_report(y_test, y_pred_rf))
print("ROC-AUC:", roc_auc_score(y_test, y_prob_rf))

import pandas as pd

results = pd.DataFrame({
    'Model': ['Logistic Regression', 'Random Forest'],
    'ROC-AUC': [
        roc_auc_score(y_test, y_prob),
        roc_auc_score(y_test, y_prob_rf)
    ]
})

results

importances = pd.Series(
    rf.feature_importances_,
    index=X_train.columns
).sort_values(ascending=False)

importances.head(10)

!pip install xgboost

from xgboost import XGBClassifier

xgb = XGBClassifier(
    eval_metric='logloss',
    random_state=42
)

xgb.fit(X_train, y_train)

import joblib

joblib.dump(rf, "churn_model.pkl")
joblib.dump(scaler, "scaler.pkl")